<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>CRASH Case File - {{ report.report_id }}</title>
    <style>
        /* Reusing the CSS from the analytics templates for consistency */
        body { font-family: sans-serif; margin: 0; padding: 20px; font-size: 10pt; }
        header { margin-bottom: 20px; border-bottom: 2px solid #333; padding-bottom: 10px; }
        h1 { font-size: 16pt; color: #333; }
        h2 { font-size: 12pt; color: #555; border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; font-weight: bold; }
        .summary-box { background-color: #e0f7fa; padding: 10px; border-left: 5px solid #00bcd4; margin-bottom: 20px; }
        .remarks-box { background-color: #fff3e0; padding: 15px; border: 1px solid #ffcc80; margin-top: 15px; }
        
        /* Footer Specific Styles */
        footer { font-size: 8pt; color: #666; margin-top: 15px; }
        footer .footer-title { margin-bottom: 5px; font-weight: bold; }
        footer .footer-table { width: 100%; border: none; }
        footer .footer-table tr { border: none; }
        footer .footer-table td { border: none; padding: 2px; }
        footer .footer-table td.half-width { width: 50%; }
        footer .footer-disclaimer { text-align: center; margin-top: 10px; }
        hr.footer-divider { margin-top: 30px; }
    </style>
</head>
<body>
    <header>
        <h1>CRASH OFFICIAL INCIDENT CASE FILE</h1>
        <p>Report ID: <strong>{{ report.report_id }}</strong></p>
    </header>

    <h2>I. Incident & Status Summary</h2>
    <table>
        <tbody>
            <tr>
                <th style="width: 30%;">Incident Category:</th>
                <td style="font-weight: bold;">{{ report.category }}</td>
            </tr>
            <tr>
                <th>Current Status:</th>
                <td style="color: green; font-weight: bold;">{{ report.status }}</td>
            </tr>
            <tr>
                <th>Reported On (Start Time):</th>
                <td>{{ report.created_at|date:"Y-m-d H:i:s" }}</td>
            </tr>
            <tr>
                <th>Resolved On (End Time):</th>
                <td>{{ report.updated_at|date:"Y-m-d H:i:s" }}</td>
            </tr>
            <tr>
                <th>Total Resolution Time:</th>
                <td>{{ calculated_resolution_time }}</td>
            </tr>
        </tbody>
    </table>

    <h2>II. Incident Location & Details</h2>
    <table>
        <tbody>
            <tr>
                <th style="width: 30%;">Location Address:</th>
                <td>{{ report.location_barangay }}, {{ report.location_city }}</td>
            </tr>
            <tr>
                <th>Geocoordinates (Lat/Lng):</th>
                <td>{{ report.latitude }}, {{ report.longitude }}</td>
            </tr>
            <tr>
                <th>Assigned Police Office:</th>
                <td>{{ assigned_office.office_name }}</td>
            </tr>
            <tr>
                <th>Police Office ID:</th>
                <td>{{ office_id_str }}</td>
            </tr>
            <tr>
                <th>Report Description:</th>
                <td>{{ report.description|linebreaksbr }}</td>
            </tr>
        </tbody>
    </table>
    
    <h3>Resolution Summary & Remarks</h3>
    <div class="remarks-box">
        <p style="font-style: italic;">{{ report.remarks|default:"No formal remarks were recorded for this resolution." }}</p>
    </div>

    <h2>III. Evidence Media (Images/Videos)</h2>
    <style>
        .media-note { font-size: 9pt; color: #666; margin-top: 6px; }
        .media-grid { margin-top: 10px; display: block; }
        .media-item { display: inline-block; width: 40%; vertical-align: top; margin: 0 1% 12px 0; }
        .media-thumb { width: 100%; max-width: 260px; height: auto; border: 1px solid #ddd; padding: 4px; background: #fff; }
        .media-meta { font-size: 8pt; color: #444; margin-top: 4px; word-break: break-all; }
        .media-url { font-size: 8pt; color: #666; word-break: break-all; }
    </style>

    {% if image_media and image_media|length > 0 %}
        <div class="media-note">Showing up to 3 uploaded images (thumbnails).</div>
        <div class="media-grid">
            {% for m in image_media %}
                <div class="media-item">
                    <img class="media-thumb" src="{{ m.file_url }}" alt="Evidence Image {{ forloop.counter }}">
                    <!-- <div class="media-meta"><strong>media_id:</strong> {{ m.media_id }}</div> -->
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No image media was uploaded for this report.</p>
    {% endif %}

    {% if video_media and video_media|length > 0 %}
        <div class="media-note">Videos cannot be embedded in PDFs. Scan the QR code to open the video (up to 2).</div>
        <div class="media-grid">
            {% for m in video_media %}
                <div class="media-item">
                    {% if m.qr_code_base64 %}
                        <img class="media-thumb" src="{{ m.qr_code_base64 }}" alt="Video QR {{ forloop.counter }}">
                    {% endif %}
                    <!-- <div class="media-meta"><strong>media_id:</strong> {{ m.media_id }}</div> -->
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No video media was uploaded for this report.</p>
    {% endif %}

    <h2>IV. Reporter Information (For Confidential Use Only)</h2>
    <table>
        <tbody>
            <tr>
                <th style="width: 30%;">Reporter Name:</th>
                <td>{{ reporter.first_name }} {{ reporter.last_name }}</td>
            </tr>
            <tr>
                <th>Reporter Email:</th>
                <td>{{ reporter.email }}</td>
            </tr>
            <tr>
                <th>Reporter Phone:</th>
                <td>{{ reporter.phone }}</td>
            </tr>
            <tr>
                <th>Emergency Contact:</th>
                <td>{{ reporter.emergency_contact_name }} ({{ reporter.emergency_contact_number }})</td>
            </tr>
        </tbody>
    </table>

    <hr class="footer-divider">
    <footer>
        <p class="footer-title">Official Audit and Documentation Record</p>
        
        <table class="footer-table">
            <tr>
                <td class="half-width">
                    <strong>Source Office:</strong> {{ assigned_office.office_name }}
                </td>
                <td class="half-width">
                    <strong>Date Generated:</strong> {{ current_datetime|date:"Y-m-d H:i:s" }}
                </td>
            </tr>
            <tr>
                <td>
                    <strong>Report Authored By:</strong> {{ assigned_office.head_officer }} (Head Officer)
                </td>
                <td>
                    <strong>Purpose/Remarks:</strong> This data is for internal audit, strategic resource deployment, and government compliance only.
                </td>
            </tr>
        </table>
        <p class="footer-disclaimer">
            CRASH System V1.0 - Confidential Law Enforcement Data
        </p>
    </footer>
</body>
</html>