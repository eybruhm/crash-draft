‚òëÔ∏è Written Day From The Roadmap
DAY 4: Chat System & Directions Integration
Goal: Enable real-time messaging and navigation features
Step 1: Frontend - Create Messages Service
Sub-steps:
1.	Create src/services/messagesService.js
2.	Add getMessages(reportId), sendMessage(reportId, content, senderId, senderType, receiverId)
Description: Messages are nested under reports in the API.
Step 2: Frontend - Wire Chat Modal
Sub-steps:
1.	In ReportChatModal, replace mock data with getMessages(reportId)
2.	On send, call sendMessage() API
3.	Add polling (every 5 seconds) to fetch new messages
4.	Handle sender/receiver IDs correctly (police office ID vs user ID)
5.	Map backend timestamps to frontend display format
Description: Chat now works with real database. Polling simulates real-time.
Step 3: Backend - Add Google Maps API Key to .env
Sub-steps:
1.	Verify GOOGLE_MAPS_API_KEY is in backend .env
2.	Test /api/reports/{id}/route/ endpoint returns valid URL + QR
Description: Directions endpoint needs the key to generate QR/URL.
Step 4: Frontend - Wire Directions Modal
Sub-steps:
1.	When "Directions" clicked, call /api/reports/{id}/route/ API
2.	Use response directions_url and qr_code_base64
3.	Keep frontend haversine calculation as fallback if API fails
4.	Display both backend QR and frontend-calculated distance/ETA
Description: Backend provides official route; frontend can still show estimate.
Step 5: Frontend - Update Distance/ETA Display
Sub-steps:
1.	If backend response includes distance/duration from Google Directions API, use those
2.	Update state so ReportDetailsModal shows accurate info
3.	Add comment explaining fallback logic
Description: Accurate routing data improves police response.




‚òëÔ∏è Sample Documentation
üìã Documentation: Day 4 - Chat System & Directions Integration
What Was Done
Step 1: Create Messages Service
‚Ä¢	Created messagesService.js with two functions:
o	getMessages(reportId) - Fetches all messages for a report
o	sendMessage(reportId, content, senderId, senderType, receiverId) - Sends a new message
‚Ä¢	API endpoints used:
o	GET /reports/{report_pk}/messages/
o	POST /reports/{report_pk}/messages/
Step 2: Wire ReportChatModal to Real API
‚Ä¢	Completely rewrote ReportChatModal.jsx:
o	Removed TemporaryDatabase dependency
o	Added useAuth() hook to get police officer's office_id as sender
o	Implemented 5-second polling using setInterval for real-time message updates
o	Added reporterId field to report mapping (for receiver ID)
o	Added loading and error states with user feedback
o	Auto-scroll to latest message on new messages
Step 3: Wire DirectionsModal to Backend API
‚Ä¢	Updated DirectionsModal.jsx:
o	Added getReportRoute(reportId) API call to fetch route data
o	Backend returns { directions_url, qr_code_base64 }
o	QR code now displays from backend (generated using qrcode Python library)
o	Added loading/error states with fallback to Haversine formula calculation
o	Police office location now comes from user context (latitude/longitude)
Step 4: Fix Police Office Location for Directions
‚Ä¢	Updated PoliceOfficeLoginSerializer to include latitude and longitude fields
‚Ä¢	DirectionsModal uses user.latitude and user.longitude from AuthContext
‚Ä¢	Falls back to Metro Manila coordinates (14.5995, 120.9842) if not available
Step 5: Add reporterId to Report Mapping
‚Ä¢	Updated Dashboard.jsx - added reporterId: backendReport.reporter?.user_id
‚Ä¢	Updated mapService.js - added reporterId to mapReportToMarker function
________________________________________
Files Created and Modified
Created:
‚Ä¢	File: src/services/messagesService.js
o	Purpose: API service for chat messages (getMessages, sendMessage)
Modified:
‚Ä¢	File: src/components/ReportChatModal.jsx
o	Changes: Complete rewrite - real API, polling, auth integration
‚Ä¢	File: DirectionsModal.jsx
o	Changes: Backend QR code, route API, police location from auth
‚Ä¢	File: src/pages/Dashboard.jsx
o	Changes: Added reporterId to mapBackendReportToFrontend
‚Ä¢	File: src/services/mapService.js
o	Changes: Added reporterId to mapReportToMarker
‚Ä¢	File: serializers.py
o	Changes: Added latitude, longitude to PoliceOfficeLoginSerializer
________________________________________
How to Test
Test 1: Chat System
1.	Login as a police officer
2.	Open Dashboard ‚Üí Click on a report ‚Üí Click "Chat" button
3.	Expected:
o	Chat modal opens
o	Previous messages load (if any)
o	You can type and send a new message
o	Messages should appear without page refresh (polling every 5s)
4.	Check for:
o	Loading spinner while fetching messages
o	Error message if API fails
o	New messages appear automatically
Test 2: Directions Modal
1.	Login as a police officer (log out first to get new lat/lng fields!)
2.	Open Dashboard ‚Üí Click on a report ‚Üí Click "Get Directions" button
3.	Expected:
o	Directions modal opens with map
o	QR code displays (generated by backend)
o	Distance and ETA shown
o	"Open in Google Maps" button works
4.	Check for:
o	Loading state while fetching route
o	Error banner if route API fails
o	QR code should be scannable
Test 3: Backend Route Endpoint
# Test the route endpoint directly (replace {report_id} with real ID)
curl -X GET "http://localhost:8000/api/reports/{report_id}/route/" -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
Expected response:
{
  "directions_url": "https://www.google.com/maps/dir/...",
  "qr_code_base64": "data:image/png;base64,..."
}

Pre-requisites for Testing:
1.	Backend running: python manage.py runserver
2.	Frontend running: npm run dev
3.	GOOGLE_MAPS_API_KEY: Must be in backend .env file
4.	Re-login required: To get updated user data with lat/lng fields
________________________________________
Current State
‚Ä¢	Component: messagesService.js
o	Status: Ready
o	Notes: API functions complete
‚Ä¢	Component: ReportChatModal
o	Status: Ready
o	Notes: Real API with 5s polling
‚Ä¢	Component: DirectionsModal
o	Status: Ready
o	Notes: Backend QR, route API
‚Ä¢	Component: PoliceOfficeLoginSerializer
o	Status: Updated
o	Notes: Now includes lat/lng
‚Ä¢	Component: Report mapping
o	Status: Updated
o	Notes: reporterId added
Integration Status:
‚Ä¢	‚úÖ Day 1: Basic Setup & Auth - Complete
‚Ä¢	‚úÖ Day 2: Reports & Filtering - Complete
‚Ä¢	‚úÖ Day 3: Map & Geocoding - Complete
‚Ä¢	‚úÖ Day 4: Chat & Directions - Complete
‚Ä¢	‚è≥ Day 5: Testing & Polish - Not Started
________________________________________
Important Notes
1.	Re-login Required: After updating the serializer, users must log out and log back in to receive the new latitude and longitude fields in their user data.
2.	GOOGLE_MAPS_API_KEY: The backend route endpoint requires a valid Google Maps API key in .env for QR code generation. Without it, the endpoint may return an error.
3.	Polling Consideration: The chat uses 5-second polling which may increase API calls. For production, consider WebSockets for real-time messaging.
4.	Fallback Behavior:
o	If route API fails ‚Üí Uses Haversine formula for distance/ETA
o	If user lat/lng missing ‚Üí Falls back to Metro Manila coordinates
o	If QR fails to load ‚Üí Shows "QR Code" placeholder text
5.	Message Model Fields:
o	sender_type: "police" or "user"
o	sender_id: police office_id or user_id
o	receiver_id: the other party's ID
________________________________________
Next Steps / Day 5 Preview: Testing & Polish
Building on what we completed in Day 4, Day 5 will focus on:
1.	Error Handling Audit
o	Review all API calls for proper try/catch
o	Add user-friendly error messages
o	Handle network failures gracefully
2.	Loading States Review
o	Ensure all async operations show loading indicators
o	Prevent double-clicks/submissions
3.	Edge Cases
o	Empty states (no reports, no messages)
o	Invalid report IDs
o	Session expiration handling
4.	UI Polish
o	Consistent styling across modals
o	Responsive design verification
o	Accessibility improvements
5.	Integration Testing
o	Full workflow testing (login ‚Üí view reports ‚Üí chat ‚Üí directions)
o	Cross-browser testing
________________________________________
Summary
Day 4 successfully integrated the real-time chat system and directions/navigation features with the backend API. The chat modal now polls for new messages every 5 seconds and properly identifies sender/receiver using the authenticated user's office ID and the report's reporter ID. The directions modal fetches route data and QR codes from the backend, with fallback calculations when the API is unavailable. A critical fix was made to include police office coordinates in the login response, enabling accurate route calculations from the officer's actual location.
Key Achievement: Both communication (chat) and navigation (directions) features are now fully wired to real backend APIs, replacing all mock data dependencies.



‚òëÔ∏è Written Day From The Roadmap
DAY 4 (Admin): Manual Report Page (Admin ‚ÄúCreate Report‚Äù / Data tools)
Goal: Decide what Admin is allowed to do with reports, then implement safely.
Step 1: Decide policy (important)
Sub-steps (safe defaults we implemented now):
1.	Admin1 can:
‚Ä¢	create reports manually (YES)
‚Ä¢	edit assigned office (NO)
‚Ä¢	delete reports (NO)
2.	Admin2 powers remain database-level (Supabase SQL), not via Admin web.
Description: Keeps police workflow stable. Admin web does NOT touch police status updates.
Step 2: Backend endpoints (Option B, safe subset)
Sub-steps:
1.	Add POST /api/v1/admin/reports/manual/
2.	Secure it:
‚Ä¢	JWT required
‚Ä¢	role must be admin
3.	Safety rules:
‚Ä¢	assigned_office REQUIRED (911 dispatch chooses office)
‚Ä¢	status allowed: Pending or Resolved (offline 911 cases can be inserted even if already resolved)
‚Ä¢	if status=Resolved, backend bumps tbl_summary_analytics so it counts immediately
‚Ä¢	location_city/location_barangay auto-filled via reverse geocode
Step 3: Frontend Manual Report Page
Sub-steps:
1.	Enable Manual Report page UI in Admin web (3 tabs)
2.	Tab 1: Manual Report Insert Form
‚Ä¢	required: category, lat/lng, assigned police office UUID
‚Ä¢	optional: reporter UUID, description, remarks, created_at/updated_at, status (Pending/Resolved)
3.	Tab 2: User Search (find user UUID by email/name/phone, copy/select)
4.	Tab 3: Police Search (find office UUID, copy/select)
Description: Admin can insert offline 911 reports safely without breaking police flows.

üìã Documentation: Day 4 (Admin) - Manual Report Tool
What Was Done
Step 1: Policy implemented (safe default)
‚Ä¢	Admin web can create a report manually, but cannot delete/edit/status-change.
‚Ä¢	Police web remains the only place for handling status workflow.
Step 2: Backend manual report endpoint added
‚Ä¢	Endpoint:
o	POST /api/v1/admin/reports/manual/
‚Ä¢	Behavior:
o	Requires JWT admin role
o	Auto reverse-geocodes city/barangay
o	assigned_office is REQUIRED (from 911 dispatch)
o	status can be Pending or Resolved
o	If status is Resolved, we update analytics cache immediately
o	Returns ReportListSerializer payload for immediate UI display
Step 3: Frontend Manual Report page enabled (3 tabs)
‚Ä¢	Tab 1: Manual Report Insert Form (fills real DB report row)
‚Ä¢	Tab 2: User Search (helps admin find reporter UUID)
‚Ä¢	Tab 3: Police Search (helps admin find office UUID)
________________________________________
Files Created and Modified
Modified (Backend):
‚Ä¢	Backend/core/serializers.py
o	Added: AdminManualReportCreateSerializer
‚Ä¢	Backend/core/views/__init__.py
o	Added: AdminManualReportCreateAPIView
‚Ä¢	Backend/core/urls.py
o	Added route: /admin/reports/manual/
o	Added route: /admin/users/search/
Modified (Admin Frontend):
‚Ä¢	Frontend-Admin/src/services/api.js
o	Added: createManualReport()
o	Added: searchUsers()
‚Ä¢	Frontend-Admin/src/pages/ManualReport.jsx
o	Replaced ‚ÄúNot Available Yet‚Äù with 3-tab Manual Report tool (Manual/User/Police)
________________________________________
How to Test
Test 1: Manual report creation
1.	Start backend: python manage.py runserver
2.	Start admin web: npm run dev
3.	Login as admin
4.	Go to Manual Report page
5.	Fill:
o	category
o	latitude/longitude
o	(optional) select assigned office
6.	Click ‚ÄúCreate Report‚Äù
Expected:
‚Ä¢	Success message shows new report_id
‚Ä¢	DB row inserted in tbl_reports
‚Ä¢	location_city/location_barangay should be filled (if geocoding works)
‚Ä¢	If status=Resolved, tbl_summary_analytics count should increase for that location/category
Test 2: User Search tab
1. Go to User Search tab
2. Search by email/phone/name
Expected:
‚Ä¢ Results show user UUID
‚Ä¢ Copy UUID works
‚Ä¢ ‚ÄúUse as Reporter‚Äù fills the form and returns to Manual Report tab
Test 3: Police Search tab
1. Go to Police Search tab
2. Search by office name/city/barangay
Expected:
‚Ä¢ Results show office UUID
‚Ä¢ Copy UUID works
‚Ä¢ ‚ÄúUse as Assigned Office‚Äù fills the form and returns to Manual Report tab
________________________________________
Current State
‚Ä¢	Admin Manual Report tool: ‚úÖ Ready (create-only)
‚Ä¢	Policy: ‚úÖ Safe default (no delete/edit/status from Admin)
Important Notes
1.	This endpoint is separate from /reports/ to avoid impacting Police flow.
2.	If Google API key/quota fails, geocoding may return null fields.
Next Steps / Day Preview
‚Ä¢	If you decide Admin1 should also ‚Äúreassign office‚Äù, add a separate admin endpoint (PATCH /api/v1/admin/reports/{id}/assign-office/) with strict rules.
Summary
Day 4 added an admin-only ‚ÄúManual Report‚Äù tool that can create reports safely without affecting police workflows. It uses dedicated endpoints, forces status to Pending, and uses the existing barangay geocoding logic for location fields.