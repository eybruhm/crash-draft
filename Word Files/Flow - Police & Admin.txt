ðŸš” CRASH Police Web Flow (Not updated so ignore some)
1. Police Login Page
Action: A Police Officer enters their email and password into the login form. Data Check: The system verifies the credentials against the email and password_hash fields in the tbl_police_offices table. Scenario: Upon successful authentication, the user is redirected to the Dashboard Page.


2. Dashboard Page (Active Reports Overview)
Data Display: The dashboard fetches all reports where the status field in tbl_reports is NOT 'Resolved' nor 'Canceled'. The data is joined with tbl_users via reporter_id to display Name and Contact.
Actions: Buttons for View, Directions, and Open Chat.
2A. Action: View Details Function: Opens a popup showing Reporter Details (from tbl_users), Incident Details (from tbl_reports), and attached media (from tbl_media). Response Status: Allows the Police Officer to update status (which triggers the trigger_set_timestamp on tbl_reports).
2B. Action: Directions Routing Data Flow: The system uses the Officer's location (tbl_police_offices) and the Incident's location (tbl_reports) to call the Google Maps API. Output: Calculates ETA and distance and generates a QR Code encoding the Directions URL for mobile scanning.
2C. Action: Open Chat Data Flow: Fetches conversation history from tbl_messages filtered by report_id. Messaging: Police can send and receive messages; new messages are inserted into tbl_messages with sender_type='police'.


3. Live Map Page
Purpose: Real-time visualization for resource deployment and situational awareness. Pin Toggles: Allows the officer to customize the view based on Active Cases (tbl_reports), Police Stations (tbl_police_offices), and Police Checkpoints (tbl_checkpoints). Checkpoint Status Flow: Checks time_start and time_end in tbl_checkpoints against local time to display Active or Inactive status. Checkpoint Management: Police Officers can Add, Edit, or Remove entries in tbl_checkpoints.


4. Analytics Page (Volume & Hotspot Analysis)
Purpose: To support strategic decision-making and identify operational needs using aggregated data.
4.1 Universal Filter Controls: These filters apply to all data displayed on this page and are sent with the Print/Export request. Filters: Timeframe, Data Scope (All/Our Office), City, Barangay (cascading), and Crime Category.
4.2 Report Volume Overview (Summary Section) Data Display: Shows Total Reports Assigned and the Average Resolution Time (calculated from tbl_reports created_at and updated_at).
4.3 Location & Category Hotspots (Analysis Sections) Output: All displays rely on the current 4.1 filters: * Top 5 Locations Analysis: * Case A (City=All, Barangay=All): Ranks Top 5 City-Barangay combinations. * Case B (City=Specific, Barangay=All): Ranks Top 5 Barangays within the selected City. * Case C (City=Specific, Barangay=Specific): Replaced by a single row of selected Barangay's total report count. * Category Concentration Analysis: * Case 1 (Category=All): Ranks Top 5 Categories (Count & Percentage). * Case 2 (Category=Specific): Replaced by a single row showing the Count & Percentage for the single selected crime type.
4.4 Action: Print/Export Full Analysis Button Process: Captures all active 4.1 filters and sends a GET request to the new export API endpoint to generate the printable PDF/Excel file.


5. Resolved Cases Page (Audit Log)
Purpose: Dedicated page for auditing case closures and resolution performance.
5.1 Local Filter Controls: Filters the data by Timeframe and Data Scope (All/Our Office).
5.2 Data Display: Fetches all reports where status is 'Resolved'. Displays detailed columns including the Resolution Time (calculated using created_at and updated_at).
5.3 Action: View Details: Allows the officer to view the full audit details, including the Resolution Summary found in the remarks field of tbl_reports.


ðŸ’» CRASH Admin Web Flow (Not updated so ignore some)

1. Login Flow (Page 1)
The Admin initiates access by providing Email/Username (1.1) and Password (1.2). The system sends a POST request to /api/v1/auth/login/. The backend verifies the credentials against the email/username and password_hash in the tbl_admin table. If successful, the Admin is redirected to the Dashboard (Page 2). If unsuccessful, the system displays a login error.


2. Dashboard Flow (Page 2)
Upon page load, the system sends a GET request to /api/v1/admin/police-offices/ to retrieve the latitude and longitude of all police stations. The system then renders the Map Display (2.1) and places clickable pins representing each police office location. When an Admin clicks a pin (2.2), the system displays popup of the Police Office Name, City, Barangay, Head Officer, and UUID of the corresponding record from tbl_police_offices.


3. Police Account Management Flow (Page 3 - CRUD)
This page handles the maintenance of law enforcement access.
3A. View/Edit Police Accounts (Read and Update)
Page Load: The system sends a GET request to /api/v1/admin/police-offices/ to fetch all police account records.
Process: The results are displayed in a list or editable grid (3.1).
Action (Edit): When the Admin clicks the Edit Action (3.3) on a specific row, a popup form opens, pre-filled with the current data.
Action (Save): If the Admin modifies fields (Office Name, Email, Contact No., Head Officer, etc.) and clicks Save, the system sends a PATCH request to /api/v1/admin/police-offices/{office_id}/.
DB Action: The backend UPDATEs the specified fields in the tbl_police_offices record.
3B. Add Police Account (Create)
Action (Add): The Admin initiates the Add Police Account action (3.2).
Input: The Admin fills out the required fields including Email, Password, Location (Lat/Lng), and optional fields.
Process: The Admin clicks the Register button. The system sends a POST request to /api/v1/admin/police-offices/.
DB Action: The backend hashes the Password and INSERTs the new record into tbl_police_offices.
Scenario (Error): If the inputted Email already exists, the system handles a Unique Constraint Violation and displays an error message.
3C. Delete Police Account (Delete)
Action (Delete): The Admin clicks the Delete Action (3.4) on a specific row.
Process: The system displays a Confirmation Dialog. If confirmed, the system sends a DELETE request to /api/v1/admin/police-offices/{office_id}/.
DB Action: The record is DELETEd from tbl_police_offices.


This flow allows the Admin to manually log external reports (e.g., 911 calls, offline submissions) and assign them a status that dictates whether they enter the live queue.
4. Manual Report Insertion Flow (Page 4 - External Data Entry)
The primary goal of this flow is to ensure reports from non-CRASH sources are correctly entered for analytics and routing.
Form State: The Report Form (4.1) displays input fields for all fields from tbl_reports (including UUIDs, timestamps, and geolocation). Critically, the Status field allows selection between 'Pending' or 'Resolved'. Input data is retained even when the Admin navigates to the search tools.
4A. Search User (4.2.1):
Action: Admin enters a Name or UUID to search.
Process: Sends a GET request to /api/v1/users/search/?query=....
DB Query: Selects the matching record(s) from tbl_users.
Display: Shows all fields excluding password_hash to allow the Admin to easily copy the user_id (UUID) for pasting into the Report Form's reporter_id field.
4B. Search Police Office (4.2.2):
Action: Admin enters an Office Name or UUID to search.
Process: Sends a GET request to /api/v1/admin/police-offices/search/?query=....
DB Query: Selects the matching record(s) from tbl_police_offices.
Display: Shows all fields to allow the Admin to copy the office_id (UUID) for pasting into the Report Form's assigned_office_id field.
4C. Submit Report:
Action: Admin clicks Submit Report (4.3) after filling out all required fields, including the Status and manual timestamps.
Process: Sends a POST request to /api/v1/reports/manual/.
DB Action: INSERTs the complete record into tbl_reports.
Status Routing Logic:
If Status is 'Pending': The report is immediately displayed on the Police Web Dashboard and is ready for status updates and dispatch. It will also be accessible to the citizen via the mobile app once their connection is restored.
If Status is 'Resolved': The report is marked as complete and will only appear on the Resolved Cases Page (Page 5) and in the aggregated analytics.
Scenario (Error): If the submitted reporter_id or assigned_office_id does not exist in their respective tables (a Foreign Key Constraint Violation), the system displays an error.

5. Profile Page Flow (Page 5)
Page Load: Sends a GET request to /api/v1/admin/profile/ to display Admin Details (Username, Email, Contact No., Created At) (5.1).
5A. Edit Details:
Action: Admin modifies fields (5.2).
Process: Sends a PATCH request to /api/v1/admin/profile/.
DB Action: UPDATEs the tbl_admin record.
5B. Change Password:
Action: Admin clicks Change Password (5.3) and enters new credentials in a popup.
Process: Sends a PATCH request. The backend verifies the old password and hashes the new one.
DB Action: UPDATEs the password_hash in tbl_admin.
5C. Logout:
Action: Admin clicks Logout (5.4).
Process: Sends a POST request to /api/v1/auth/logout/. The server invalidates the current session/token.
Scenario: Redirects the user back to the Login Page (Page 1).



