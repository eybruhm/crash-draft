# CRASH Admin API Endpoints Documentation

This document outlines all API endpoints used in the CRASH Admin application. These are currently mocked with localStorage but ready to be replaced with real backend calls.

## Authentication Endpoints

### POST /auth/login
**Purpose**: Authenticate admin user with credentials

**Current Implementation**: `src/services/api.js` - `loginAdmin()`

**Request Body**:
```json
{
  "usernameOrEmail": "admin@example.com or admin",
  "password": "password"
}
```

**Response**:
```json
{
  "id": "admin-1",
  "username": "admin",
  "email": "admin@example.com",
  "contact": "09171234567",
  "createdAt": "2025-11-22T00:00:00.000Z"
}
```

**Error**: `Invalid credentials` (401)

**Where Used**: `src/pages/Login.jsx`

**TODO**: Replace with `axios.post('/api/auth/login', { usernameOrEmail, password })`

---

## Admin Profile Endpoints

### GET /admin/stats
**Purpose**: Fetch dashboard statistics (police count, admin count, recent accounts)

**Current Implementation**: `src/services/api.js` - `getStats()`

**Response**:
```json
{
  "totalPolice": 5,
  "totalAdmins": 1,
  "last5": [
    {
      "id": "police-1",
      "officeName": "Manila Police Station",
      "email": "manila@police.gov",
      "contact": "02-1234567",
      "headName": "Officer Juan",
      "location": { "lat": 14.5995, "lng": 120.9842 },
      "createdAt": "2025-11-22T00:00:00.000Z"
    }
  ]
}
```

**Where Used**: `src/pages/Dashboard.jsx`

**TODO**: Replace with `axios.get('/api/admin/stats')`

---

### GET /admin/profile/:email
**Purpose**: Fetch admin profile information

**Current Implementation**: `src/services/api.js` - `getAdminProfile()`

**Parameters**:
- `email` (path): Admin email address

**Response**:
```json
{
  "id": "admin-1",
  "username": "admin",
  "email": "admin@example.com",
  "contact": "09171234567",
  "createdAt": "2025-11-22T00:00:00.000Z"
}
```

**Error**: `Not found` (404)

**Where Used**: `src/pages/Profile.jsx`

**TODO**: Replace with `axios.get('/api/admin/profile/${email}')`

---

### POST /admin/change-password
**Purpose**: Update admin password

**Current Implementation**: `src/services/api.js` - `changePassword()`

**Request Body**:
```json
{
  "email": "admin@example.com",
  "newPassword": "newSecurePassword123"
}
```

**Response**: `true` (success)

**Error**: `Not found` (404)

**Where Used**: `src/pages/Profile.jsx`

**TODO**: Replace with `axios.post('/api/admin/change-password', { email, newPassword })`

---

## Police Station Endpoints

### GET /police
**Purpose**: List all police station accounts

**Current Implementation**: `src/services/api.js` - `listPolice()`

**Response**:
```json
[
  {
    "id": "police-1",
    "email": "manila@police.gov",
    "officeName": "Manila Police Station",
    "contact": "02-1234567",
    "headName": "Officer Juan",
    "location": { "lat": 14.5995, "lng": 120.9842 },
    "createdAt": "2025-11-22T00:00:00.000Z"
  }
]
```

**Where Used**: 
- `src/pages/RemoveAccounts.jsx`
- `src/pages/EditAccounts.jsx`
- `src/pages/ActiveMap.jsx`

**TODO**: Replace with `axios.get('/api/police')`

---

### POST /police
**Purpose**: Create new police station account

**Current Implementation**: `src/services/api.js` - `addPolice()`

**Request Body**:
```json
{
  "email": "manila@police.gov",
  "officeName": "Manila Police Station",
  "contact": "02-1234567",
  "headName": "Officer Juan",
  "location": { "lat": 14.5995, "lng": 120.9842 },
  "password": "autoGenerated" (optional)
}
```

**Response**:
```json
{
  "id": "police-1",
  "email": "manila@police.gov",
  "password": "changeme",
  "officeName": "Manila Police Station",
  "contact": "02-1234567",
  "headName": "Officer Juan",
  "location": { "lat": 14.5995, "lng": 120.9842 },
  "createdAt": "2025-11-22T00:00:00.000Z"
}
```

**Where Used**: `src/pages/AddAccount.jsx`

**TODO**: Replace with `axios.post('/api/police', payload)`

---

### PUT /police/:id
**Purpose**: Update police station account details

**Current Implementation**: `src/services/api.js` - `updatePolice()`

**Parameters**:
- `id` (path): Police station ID

**Request Body** (any/all of these fields):
```json
{
  "officeName": "Updated Manila Police Station",
  "contact": "02-9876543",
  "headName": "Officer Pedro",
  "location": { "lat": 14.6000, "lng": 120.9850 }
}
```

**Response**:
```json
{
  "id": "police-1",
  "email": "manila@police.gov",
  "officeName": "Updated Manila Police Station",
  "contact": "02-9876543",
  "headName": "Officer Pedro",
  "location": { "lat": 14.6000, "lng": 120.9850 },
  "createdAt": "2025-11-22T00:00:00.000Z"
}
```

**Error**: `Not found` (404)

**Where Used**: `src/pages/EditAccounts.jsx`

**TODO**: Replace with `axios.put('/api/police/${id}', updates)`

---

### DELETE /police/:id
**Purpose**: Remove police station account

**Current Implementation**: `src/services/api.js` - `removePolice()`

**Parameters**:
- `id` (path): Police station ID

**Response**: `true` (success)

**Error**: `Not found` (404)

**Where Used**: `src/pages/RemoveAccounts.jsx`

**TODO**: Replace with `axios.delete('/api/police/${id}')`

---

## Implementation Guide

### Step 1: Install Axios
```bash
npm install axios
```

### Step 2: Create API Configuration
Create `src/config/apiClient.js`:
```javascript
import axios from 'axios'

export const apiClient = axios.create({
  baseURL: process.env.REACT_APP_API_BASE_URL || 'http://localhost:3000/api',
  timeout: 10000,
})

// Add auth token to headers if needed
apiClient.interceptors.request.use((config) => {
  const token = sessionStorage.getItem('crash_admin_token')
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})
```

### Step 3: Update API Service
Replace mock functions in `src/services/api.js` with real API calls:

**Example**:
```javascript
import { apiClient } from '../config/apiClient'

export const api = {
  loginAdmin({ usernameOrEmail, password }) {
    return apiClient.post('/auth/login', { usernameOrEmail, password })
      .then(res => res.data)
  },
  
  listPolice() {
    return apiClient.get('/police')
      .then(res => res.data)
  },
  // ... etc
}
```

### Step 4: Test Each Endpoint
- Run the dev server
- Test each page's functionality
- Verify API calls in browser DevTools Network tab

---

## Status Summary

| Endpoint | Status | File | TODO |
|----------|--------|------|------|
| POST /auth/login | Mock | api.js | Replace |
| GET /admin/stats | Mock | api.js | Replace |
| GET /admin/profile/:email | Mock | api.js | Replace |
| POST /admin/change-password | Mock | api.js | Replace |
| GET /police | Mock | api.js | Replace |
| POST /police | Mock | api.js | Replace |
| PUT /police/:id | Mock | api.js | Replace |
| DELETE /police/:id | Mock | api.js | Replace |

---

## Notes

- All endpoints currently use `localStorage` as the backend
- Responses are delayed by 200-300ms to simulate network latency
- When implementing real APIs, maintain the same response structure
- Consider adding error handling and retry logic
- Store auth token securely (e.g., sessionStorage for now, httpOnly cookies for production)
